{"version":3,"sources":["assets\\_Game\\Script\\Manager\\LevelManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Character from \"../Character\";\r\nimport Enemy from \"../Enemy\";\r\nimport SimplePool, { PoolType } from \"../Pool/SimplePool\";\r\nimport Ship from \"../Ship\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class LevelManager extends cc.Component {\r\n\r\n   // singleton\r\n   private static ins: LevelManager;\r\n   public static get Ins(): LevelManager {\r\n      return LevelManager.ins;\r\n   }\r\n\r\n   protected onLoad(): void {\r\n      LevelManager.ins = this;\r\n   }\r\n   //------------------------------------\r\n\r\n   //Level Manager sẽ điều khiển luồng chính trong game\r\n\r\n   @property(Ship)\r\n   public ship: Ship = null;\r\n\r\n   @property(cc.Node)\r\n   public stage_1: cc.Node[] = [];\r\n\r\n   @property(cc.Node)\r\n   public stage_2: cc.Node[] = [];\r\n\r\n   private list: Character[] = [];\r\n   private isBooster: boolean;\r\n   private stage: number = 0;\r\n   private level: number = 1;\r\n\r\n   protected start(): void {\r\n      this.onLoadStage_1();\r\n      this.isBooster = false;\r\n      //di chuyển tàu lên xong đợi  người chơi điều khiển\r\n      this.ship.onAwake();\r\n   }\r\n\r\n\r\n   public onLoadStage_1(): void {\r\n      for (let i = 0; i < this.stage_1.length; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_1, this.stage_1[i].getWorldPosition().add(cc.Vec3.UP.mul(1000)), 0);\r\n         e.moveTo(this.stage_1[i].getWorldPosition(), 1, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n   }\r\n\r\n   public onLoadStage_2(): void {\r\n      //bay từ 2 bên sang\r\n      for (let i = 0; i < 14; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_1, this.node.getWorldPosition().add(new cc.Vec3(-1000, 0, 0)), 0);\r\n         e.moveTo(this.stage_2[i].getWorldPosition(), 0.5, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n\r\n      for (let i = 13; i < this.stage_2.length; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_1, this.node.getWorldPosition().add(new cc.Vec3(1000, 0, 0)), 0);\r\n         e.moveTo(this.stage_2[i].getWorldPosition(), 0.5, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n   }\r\n\r\n   public onLoadStage_2_1(): void {\r\n      for (let i = 0; i < this.stage_1.length; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_2, this.stage_1[i].getWorldPosition().add(cc.Vec3.UP.mul(1000)), 0);\r\n         e.moveTo(this.stage_1[i].getWorldPosition(), 1, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n   }\r\n\r\n   public onLoadStage_2_2(): void {\r\n      //bay từ 2 bên sang\r\n      for (let i = 0; i < 14; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_2, this.node.getWorldPosition().add(new cc.Vec3(-1000, 0, 0)), 0);\r\n         e.moveTo(this.stage_2[i].getWorldPosition(), 0.5, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n\r\n      for (let i = 13; i < this.stage_2.length; i++) {\r\n         let e = SimplePool.spawnT<Enemy>(PoolType.Enemy_2, this.node.getWorldPosition().add(new cc.Vec3(1000, 0, 0)), 0);\r\n         e.moveTo(this.stage_2[i].getWorldPosition(), 0.5, true);\r\n         this.list.push(e);\r\n         e.onInit(40);\r\n      }\r\n   }\r\n\r\n   onFinish() {\r\n      //kết thúc màn game di chuyển tàu lên thẳng phía trên\r\n      this.ship.onFinish();\r\n      this.stage++;\r\n   }\r\n\r\n\r\n   // Hàm chờ 3 giây\r\n   waitAndExecute(callback: () => void) {\r\n      setTimeout(() => {\r\n         callback(); // Gọi hàm callback sau khi chờ 3 giây\r\n      }, 5000);\r\n   }\r\n\r\n   \r\n   //enemy death sẽ gọi vào hàm này\r\n   //nếu ship chết thì cần viết 1 func khác để ship gọi vào\r\n   public onEnemyDeath(c: Character): void {\r\n\r\n      //remove enemy ra khỏi list\r\n      let index = this.list.indexOf(c);\r\n      if (index != -1) {\r\n         this.list.splice(index, 1);\r\n      }\r\n\r\n      //nếu kết thúc stage thì next stage\r\n      if (this.list.length == 0) {\r\n         this.stage++;\r\n         switch (this.stage) {\r\n            case 0:\r\n               this.onLoadStage_1();\r\n               break;\r\n            case 1:\r\n               this.onLoadStage_2();\r\n               break;\r\n            case 2:\r\n               //this.onFinish();\r\n               this.onLoadStage_2_1();\r\n               break;\r\n            case 3:\r\n               this.onLoadStage_2_2();\r\n               this.waitAndExecute(()=>this.onFinish());\r\n               break;\r\n         }\r\n         \r\n      }\r\n\r\n      //if(this.stage>4) this.stage = 0;\r\n      //enemy đầu tiên chết sẽ tạo booster ra\r\n      if (!this.isBooster) {\r\n         this.isBooster = true;\r\n         SimplePool.spawn(PoolType.Booster, c.node.getWorldPosition());\r\n      }\r\n   }\r\n\r\n}\r\n"]}